# HW_1_MLDS_2022

1. **Что было сделано** (помимо базового задания из ноутбука):
 - удалено **1,159 дублей** (train)
 - **количественные** признаки **стандартизированы** 
 - у четырех признаков найдено 186 пропущенных значений (~ 3% от выборки), **все пропуски заменены на среднее 5 ближайших соседей, вес каждого соседа учтен индивидуально,** в зависимости от расстояния до миссинга, использовалась модель KNN Imputer  
  - проведена работа по **созданию новых признаков:**
    - распарсены **mileage, engine, max_power,** чтобы избавиться от текстовых значений и выделить числовые 
    - распарсен признак **name** и создано 2 новых признака: **car_brand (марка)**, **car_brand_model (модель)** 
    
    <img width="373" alt="image" src="https://user-images.githubusercontent.com/79000315/205503793-f5ad08be-ab2a-45c2-b913-aaf2864fd211.png">
    
    - от признака **car_brand_model (модель)** отказался, так как много моделей в единственном экземпляре, а их общее число - более 200 -> оставляю только **car_brand_model (модель)**

    <img width="270" alt="image" src="https://user-images.githubusercontent.com/79000315/205504049-b9e78b61-8a0e-40a6-a84c-bb62f341491f.png">
    
    - далее есть смысл разбить все марки на 3 группы по уровню премиальности **(lux/ mid/ econom)**

  - **созданы дополнительные КАТЕГОРИАЛЬНЫЕ признаки:**
    - **car_dealers** - объединил малораспространенные признаки в **seller_type** (Trustmark Dealer -> Dealer)       
    - **car_class** - создано 3 класса авто по уровню премиальности **(lux/ mid/ econom)** в зависимости от медианы стоимости каждого бренда  
    - **car_region** - регион производства автомобиля **(Europe/ Asia/ USA/ India)**   

  - **созданы дополнительные КОЛИЧЕСТВЕННЫЕ признаки:**
    - **car_owners** - число предыдущих владельцев (трейд-ин и 4 предыдущих владельца объединил в один код)
    - **car_age** - возраст автомобиля в годах (относительно 2022 года)       
    - **car_age_sq** - возраст автомобиля в квадрате    
    - **car_annual_km** - средний ежегодный пробег автомобиля     
    - **car_owner_km** - сколько км. в год проезжал один владелец      
    - **car_power_litr** - мощность в пересчете на 1 литр объема  (уровень "спортивности" автомобиля)   
    - **car_diff_power** - насколько мощность конкретного авто отличается от медианного значения по выборке - насколько он более мощный, чем в среднем    
    - **car_diff_km_per_year** - насколько пробег конкретного авто отличается от медианы     
    - **car_diff_mileage** - насколько экономичность конкретного авто отличается от медианы   

- В целях улучшения предсказательной силы проведен **кластерный анализ KMeans** на train'е. Изучалось 9 решений - на 2 -> 10 кластеров. По итогам **silhouette_score выбрано решение на 5 кластеров.**

   <img width="651" alt="image" src="https://user-images.githubusercontent.com/79000315/205505195-50691cda-e53a-49c0-a3f4-4b2216bf9eaa.png">     

- доли сегментов на train   

   <img width="95" alt="image" src="https://user-images.githubusercontent.com/79000315/205514555-3b7ed3d2-67cf-4611-883c-8e31613fb57c.png">


- перенес модель кластерного решения на test - получил 4 кластера, информация о принадлежности к сегменту добавлена в test, доля сегментов не отличается от train   

   <img width="80" alt="image" src="https://user-images.githubusercontent.com/79000315/205514525-b3660b3f-650d-4f16-a3e8-ad2d3d3e1bc6.png">

2. **Подготовлено 5 моделей:**
- baseline (только на вещественных признаках без feature-engineering)
- только на количественных признаках после feature-engineering
- на всех признаках по итогам feature-engineering
- удалены признаки, которые в наименьшей степени связаны с таргетом
- на всех признаках по итогам feature-engineering + polynomial features

Все расчеты проводились на модели **Lasso()**, чтобы занулить неважные признаки и в целях сравнимости результатов. Для подбора гиперпараметров регуляризации использовался **GridSearch**. 

3. **Baseline** показала самое низкое качество на test (R2 = 0.59) и самое низкое по бизнес-метрике (0.189) 
<img width="338" alt="image" src="https://user-images.githubusercontent.com/79000315/205514671-dab749e6-a2a3-4261-9fa1-f14229047922.png">

<img width="328" alt="image" src="https://user-images.githubusercontent.com/79000315/205514687-b7e07d79-4868-46cf-98d2-1345383024e8.png">

4. **Модель только на количественных признаках** увеличила как R2 (0.63), так и бизнес-метрику: 0.189 -> 0.218
<img width="441" alt="image" src="https://user-images.githubusercontent.com/79000315/205514780-1c3e7965-6ce5-42a6-a594-ae707f09f439.png">
<img width="329" alt="image" src="https://user-images.githubusercontent.com/79000315/205514796-01a827b7-45ae-4ce5-a6b5-b113a1e43acd.png">

5. У **Модели на всех признаках** - высокий R2 (0.69) и бизнес-метрика: 0.189 -> 0.259
<img width="358" alt="image" src="https://user-images.githubusercontent.com/79000315/205514831-ea7fd1d6-6ee7-4b58-b433-44ea083e781d.png">
<img width="332" alt="image" src="https://user-images.githubusercontent.com/79000315/205514864-c3c54c02-1bbf-46b9-939e-2187a4e0442b.png">


При создании модели **столкнулся с проблемой** - часть признаков присутствует в train, но отсутствует в test (и наоборот). Это приведет к проблемам в расчетах (размерность/ состав train и test не совпадут). 

<img width="458" alt="image" src="https://user-images.githubusercontent.com/79000315/205507876-f883b499-ceb1-4e36-a142-395509fbad39.png">

Признаки, в которых есть несовпадения.

<img width="463" alt="image" src="https://user-images.githubusercontent.com/79000315/205507955-a800841c-f035-42f5-835f-402619c1fe1e.png">

**Решение:** 
- кластер под номером 3 в train'е - явный "выброс" (всего 2 наблюдения), им можно пренебречь
- не совпадающие автомобильные бренды крайне малочисленны, их также можно удалить
- в итоге, добились одинаковой размерности обоих датасетов

<img width="204" alt="image" src="https://user-images.githubusercontent.com/79000315/205508146-a7f1bb5f-5ee0-4040-acde-36e8a860115c.png">

6. **Модель на сокращенном перечне признаков**
    
**Предпосылка:** 49 признаков - это много, а что если найти и удалить ненужные. Для этого воспользуюсь метрикой PPS_Score. Это аналог корреляции Пирсона, но со своими преимуществами:    
- хорошо работает с номинальными и порядковыми признаками    
- находит как линейные, так и НЕлиненые взаимосвзи     

**9 признаков имеют низкий PPS Score** с таргетом (в нижней части таблицы)

<img width="278" alt="image" src="https://user-images.githubusercontent.com/79000315/205508647-8fa6e2a8-86eb-4222-a488-582ea96a8f21.png">

Однако, их удаление практически не повлияло на результат 

<img width="362" alt="image" src="https://user-images.githubusercontent.com/79000315/205514954-20e24f97-8bac-45a6-94b1-b0d22abe727d.png">

7. **Последняя модель**: используются все признаках после feature-engineering + polynomial features во 2-й степени. **Это модель-чемпион** по всем показателям R2 (0.94),бизнес-метрика: 0.189 -> 0.354!

<img width="438" alt="image" src="https://user-images.githubusercontent.com/79000315/205637507-ca5ad90e-1c22-4228-bf3e-cd05eec0f2f0.png">

<img width="335" alt="image" src="https://user-images.githubusercontent.com/79000315/205637551-a08fae5c-d57a-4b0e-bf24-62d5d8710f1c.png">



8. **Дальнейшие шаги по улучшению модели:**
- поиграть с признаками - убрать сильно скоррелированные 
- распарсить torque (момент двигателя) и включить в аналитческий пул
- возможно, все же стоило поработать с моделями автомобилей
- логарифмировать некоторые признаки
- не добавлять в модель признаки, которые сравнивают текущее значение с медианой/ средним по выборке, так как это учитывается самой моделью (на такой вывод натолкнули результаты PPS_Score)



