# HW_1_MLDS_2022

1. **Что было сделано** (помимо базового задания из ноутбука):
 - удалено **1,159 дублей** (train)
 - **количественные** признаки **стандартизированы** 
 - у четырех признаков найдено 186 пропущенных значений (~ 3% от выборки), **все пропуски заменены на среднее 5 ближайших соседей, вес каждого соседа учтен индивидуально,** в зависимости от расстояния до миссинга, использовалась модель KNN Imputer  
  - проведена работа по **созданию новых признаков:**
    - распарсены **mileage, engine, max_power,** чтобы избавиться от текстовых значений и выделить числовые 
    - распарсен признак **name** и создано 2 новых признака: **car_brand (марка)**, **car_brand_model (модель)** 
    
    <img width="373" alt="image" src="https://user-images.githubusercontent.com/79000315/205503793-f5ad08be-ab2a-45c2-b913-aaf2864fd211.png">
    
    - от признака **car_brand_model (модель)** отказался, так как много моделей в единственном экземпляре, а их общее число - более 200 -> оставляю только **car_brand_model (модель)**

    <img width="270" alt="image" src="https://user-images.githubusercontent.com/79000315/205504049-b9e78b61-8a0e-40a6-a84c-bb62f341491f.png">
    
    - далее есть смысл разбить все марки на 3 группы по уровню премиальности **(lux/ mid/ econom)**

  - **созданы дополнительные КАТЕГОРИАЛЬНЫЕ признаки:**
    - **car_dealers** - объединил малораспространенные признаки в **seller_type** (Trustmark Dealer -> Dealer)       
    - **car_class** - создано 3 класса авто по уровню премиальности **(lux/ mid/ econom)** в зависимости от медианы стоимости каждого бренда  
    - **car_region** - регион производства автомобиля **(Europe/ Asia/ USA/ India)**   

  - **созданы дополнительные КОЛИЧЕСТВЕННЫЕ признаки:**
    - **car_owners** - число предыдущих владельцев (трейд-ин и 4 предыдущих владельца объединил в один код)
    - **car_age** - возраст автомобиля в годах (относительно 2022 года)       
    - **car_age_sq** - возраст автомобиля в квадрате    
    - **car_annual_km** - средний ежегодный пробег автомобиля     
    - **car_owner_km** - сколько км. в год проезжал один владелец      
    - **car_power_litr** - мощность в пересчете на 1 литр объема  (уровень "спортивности" автомобиля)   
    - **car_diff_power** - насколько мощность конкретного авто отличается от медианного значения по выборке - насколько он более мощный, чем в среднем    
    - **car_diff_km_per_year** - насколько пробег конкретного авто отличается от медианы     
    - **car_diff_mileage** - насколько экономичность конкретного авто отличается от медианы   

- В целях улучшения предсказательной силы проведен **кластерный анализ KMeans** на train'е. Изучалось 9 решений - на 2 -> 10 кластеров. По итогам **silhouette_score выбрано решение на 5 кластеров.**

   <img width="651" alt="image" src="https://user-images.githubusercontent.com/79000315/205505195-50691cda-e53a-49c0-a3f4-4b2216bf9eaa.png">     
   
   <img width="92" alt="image" src="https://user-images.githubusercontent.com/79000315/205507730-833db295-044d-440d-a9d4-12b7266e57d9.png">


- перенес модель кластерного решения на test - получил 4 кластера, информация о принадлежности к сегменту добавлена в test, доля сегментов не отличается от train   

   <img width="256" alt="image" src="https://user-images.githubusercontent.com/79000315/205505390-d18c76de-3d95-4200-8105-e15879de21ff.png">

2. **Подготовлено 4 модели:**
- baseline (только на вещественных признаках без feature-engineering)
- на количественных признаках после feature-engineering
- на всех признаках по итогам feature-engineering
- удалены признаки, которые в наименьшей степени связаны с таргетом

Все расчеты проводились на модели **Lasso()**, чтобы занулить неважные признаки и в целях сравнимости результатов. Для подбора гиперпараметров регуляризации использовался **GridSearch**. 

3. **Baseline** показала самое низкое качество на test (0.59), но самое высокое - по бизнес-метрике  
<img width="275" alt="image" src="https://user-images.githubusercontent.com/79000315/205506023-215bba03-f6f3-4baf-aa82-44683a1c4122.png">
<img width="352" alt="image" src="https://user-images.githubusercontent.com/79000315/205506050-ac9c88e8-9e93-4a31-8921-a6d208cef190.png">

4. **Модель только на количественных признаках** увеличила R2 (0.63), но бизнес-метрика ухудшилась: 0.223 -> 0.218
<img width="450" alt="image" src="https://user-images.githubusercontent.com/79000315/205506140-15a63f28-9582-4f81-ae6b-fbc4e53b862b.png">
<img width="329" alt="image" src="https://user-images.githubusercontent.com/79000315/205507266-f89e8ddd-0053-4026-a254-8ca8956da0ad.png">

5. **Модель на всех признаках** - чемпион по R2 (0.76), но по бизнес-метрике ситуация обратная: 0.223 -> 0.207
<img width="452" alt="image" src="https://user-images.githubusercontent.com/79000315/205507427-5b355f8f-1f76-4867-933a-b2c3277812e7.png">
<img width="360" alt="image" src="https://user-images.githubusercontent.com/79000315/205507437-1a15f372-24b2-4ff7-960c-a24042d80d49.png">

При создании модели **столкнулся с проблемой** - часть признаков присутствует в train, но отсутствует в test (и наоборот). Это приведет к проблемам в расчетах (размерность/ состав train и test не совпадут). 

<img width="458" alt="image" src="https://user-images.githubusercontent.com/79000315/205507876-f883b499-ceb1-4e36-a142-395509fbad39.png">

Признаки, в которых есть несовпадения.

<img width="463" alt="image" src="https://user-images.githubusercontent.com/79000315/205507955-a800841c-f035-42f5-835f-402619c1fe1e.png">

**Решение:** 
- кластер под номером 3 в train'е - явный "выброс" (всего 2 наблюдения), им можно пренебречь
- не совпадающие автомобильные бренды крайне малочисленны, их также можно удалить
- в итоге, добились одинаковой размерности обоих датасетов

<img width="204" alt="image" src="https://user-images.githubusercontent.com/79000315/205508146-a7f1bb5f-5ee0-4040-acde-36e8a860115c.png">

6. **Модель на сокращенном перечне признаков**
    
**Предпосылка:** 49 признаков - это много, а что если найти и удалить ненужные. Для этого воспользуюсь метрикой PPS_Score. Это аналог корреляции Пирсона, но со своими преимуществами:    
- хорошо работает с номинальными и порядковыми признаками    
- находит как линейные, так и НЕлиненые взаимосвзи     

**9 признаков имеют низкий PPS Score** с таргетом (в нижней части таблицы)

<img width="278" alt="image" src="https://user-images.githubusercontent.com/79000315/205508647-8fa6e2a8-86eb-4222-a488-582ea96a8f21.png">

Однако, их удаление практически не повлияло на результат 

<img width="369" alt="image" src="https://user-images.githubusercontent.com/79000315/205508755-9060b087-da16-4c34-9acf-f98f2fd757e4.png">

7. **Дальнейшие шаги по улучшению модели:**
- добавить polynomial features (2-й степени)
- поиграть с признаками - убрать сильно скоррелированные 
- распарсить torque (момент двигателя) и включить в аналитческий пул
- возможно, все же стоило поработать с моделями автомобилей
- логарифмировать некоторые признаки
- не добавлять в модель признаки, которые сравнивают текущее значение с медианой/ средним по выборке, так как это учитывается самой моделью (на этот вывод натолкнули результаты PPS_Score)



